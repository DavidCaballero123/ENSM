<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Camino a la Identidad: El Juego de la Adolescencia</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #1a202c 0%, #2d3748 50%, #4a5568 100%);
        }
        .progress-bar-bg { background-color: #4a5568; }
        .progress-bar-fg { transition: width 0.5s ease-in-out, background-color 0.5s ease-in-out; }
        .choice-btn {
            transition: all 0.2s ease-in-out;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
        }
        .choice-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .stat-change {
            position: absolute;
            right: 0;
            top: -20px;
            font-weight: bold;
            animation: floatUp 1.5s ease-out forwards;
        }
        .stat-change.positive { color: #4ade80; }
        .stat-change.negative { color: #f87171; }
        @keyframes floatUp {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(-25px); }
        }
        .avatar-btn { transition: all 0.2s; }
        .avatar-btn:hover {
            transform: scale(1.1);
            background-color: #38bdf8;
        }
        .consejo-docente {
            font-style: italic;
            color: #9ca3af; /* gray-400 */
            border-left: 2px solid #38bdf8; /* cyan-400 */
            padding-left: 0.75rem;
            margin-top: 0.75rem;
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen p-4">

    <div id="container" class="w-full max-w-2xl mx-auto">

        <!-- Pantalla de Inicio -->
        <div id="start-screen" class="text-center p-8 bg-gray-800 rounded-xl shadow-2xl">
            <h1 class="text-4xl font-bold text-cyan-400 mb-4">Camino a la Identidad</h1>
            <p class="text-lg text-gray-300 mb-6">Un viaje a trav√©s de la adolescencia para convertirte en un futuro docente de la Escuela Normal Superior de Michoac√°n.</p>
            <p class="text-sm text-gray-400 mb-8">Tus elecciones impactar√°n tu salud, identidad, vida social y tu preparaci√≥n acad√©mica para ingresar y destacar en la ENSM. ¬øEst√°s listo para empezar el camino del magisterio?</p>
            <button id="start-btn" class="w-full bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-3 px-6 rounded-lg text-xl choice-btn">Comenzar el Viaje</button>
        </div>

        <!-- Pantalla de Selecci√≥n de Avatar -->
        <div id="avatar-screen" class="hidden text-center p-8 bg-gray-800 rounded-xl shadow-2xl fade-in">
            <h2 class="text-3xl font-bold text-yellow-400 mb-6">Elige tu Avatar</h2>
            <div class="grid grid-cols-3 md:grid-cols-6 gap-4">
                <button class="avatar-btn text-6xl p-4 bg-gray-700 rounded-full" onclick="selectAvatar('üßë')">üßë</button>
                <button class="avatar-btn text-6xl p-4 bg-gray-700 rounded-full" onclick="selectAvatar('üë©')">üë©</button>
                <button class="avatar-btn text-6xl p-4 bg-gray-700 rounded-full" onclick="selectAvatar('üë®‚Äçü¶±')">üë®‚Äçü¶±</button>
                <button class="avatar-btn text-6xl p-4 bg-gray-700 rounded-full" onclick="selectAvatar('üë©‚Äçü¶∞')">üë©‚Äçü¶∞</button>
                <button class="avatar-btn text-6xl p-4 bg-gray-700 rounded-full" onclick="selectAvatar('üßë‚Äçüé§')">üßë‚Äçüé§</button>
                <button class="avatar-btn text-6xl p-4 bg-gray-700 rounded-full" onclick="selectAvatar('üßë‚Äçüíª')">üßë‚Äçüíª</button>
            </div>
        </div>
        
        <!-- Pantalla de Juego -->
        <div id="game-screen" class="hidden">
            <div class="bg-gray-800 rounded-xl shadow-2xl p-6 md:p-8 relative">
                <div id="avatar-display" class="absolute top-4 right-4 text-4xl bg-gray-700 rounded-full w-16 h-16 flex items-center justify-center"></div>
                <div class="mb-6">
                    <h2 id="stage-title" class="text-2xl font-bold text-center text-yellow-400 mb-2"></h2>
                    <p class="text-center text-cyan-400 text-sm mb-4">Escuela Normal Superior de Michoac√°n</p>
                </div>
                <div id="stats-container" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4 mb-8"></div>
                <div id="event-card" class="bg-gray-700 p-6 rounded-lg mb-6 min-h-[150px]">
                    <p id="event-text" class="text-lg text-gray-200"></p>
                </div>
                <div id="choices-container" class="grid grid-cols-1 gap-4 mb-6"></div>
                <div id="feedback-container" class="min-h-[120px]">
                    <div id="feedback-card" class="hidden bg-gray-900 p-4 rounded-lg">
                        <p id="feedback-text" class="text-center text-gray-300"></p>
                        <p id="consejo-docente" class="consejo-docente text-sm"></p>
                    </div>
                </div>
                <button id="next-btn" class="hidden w-full bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-3 px-6 rounded-lg text-lg choice-btn mt-4">Siguiente</button>
            </div>
        </div>

        <!-- Pantalla de Transici√≥n -->
        <div id="transition-screen" class="hidden text-center p-8 bg-gray-800 rounded-xl shadow-2xl fade-in">
            <h2 id="transition-title" class="text-3xl font-bold text-yellow-400 mb-4"></h2>
            <p id="transition-text" class="text-lg text-gray-300 mb-8"></p>
            <button id="continue-btn" class="w-full bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-3 px-6 rounded-lg text-xl choice-btn">Continuar</button>
        </div>

        <!-- Pantalla Final -->
        <div id="end-screen" class="hidden text-center p-8 bg-gray-800 rounded-xl shadow-2xl fade-in">
            <h1 class="text-4xl font-bold text-cyan-400 mb-4">Fin del Viaje</h1>
            <p id="end-title" class="text-2xl text-yellow-400 font-semibold mb-4"></p>
            <p id="end-text" class="text-lg text-gray-300 mb-8"></p>
            <div id="final-stats" class="mb-8"></div>
            <button id="restart-btn" class="w-full bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-3 px-6 rounded-lg text-xl choice-btn">Jugar de Nuevo</button>
        </div>
    </div>

    <script>
        const dom = {
            startScreen: document.getElementById('start-screen'),
            avatarScreen: document.getElementById('avatar-screen'),
            gameScreen: document.getElementById('game-screen'),
            endScreen: document.getElementById('end-screen'),
            transitionScreen: document.getElementById('transition-screen'),
            startBtn: document.getElementById('start-btn'),
            restartBtn: document.getElementById('restart-btn'),
            nextBtn: document.getElementById('next-btn'),
            continueBtn: document.getElementById('continue-btn'),
            stageTitle: document.getElementById('stage-title'),
            statsContainer: document.getElementById('stats-container'),
            eventText: document.getElementById('event-text'),
            choicesContainer: document.getElementById('choices-container'),
            feedbackCard: document.getElementById('feedback-card'),
            feedbackText: document.getElementById('feedback-text'),
            consejoDocente: document.getElementById('consejo-docente'),
            avatarDisplay: document.getElementById('avatar-display'),
            transitionTitle: document.getElementById('transition-title'),
            transitionText: document.getElementById('transition-text'),
            endTitle: document.getElementById('end-title'),
            endText: document.getElementById('end-text'),
            finalStats: document.getElementById('final-stats'),
        };

        const STAT_NAMES = {
            health: { label: 'Salud', icon: '‚ù§Ô∏è' },
            identity: { label: 'Identidad', icon: 'üë§' },
            social: { label: 'Social', icon: 'üë•' },
            academic: { label: 'Acad√©mico', icon: 'üìö' },
            vocation: { label: 'Vocaci√≥n', icon: '‚ù§Ô∏è‚Äçüî•' }
        };

        const storyEvents = [
            // --- Adolescencia Temprana (10-14 a√±os) ---
            { stage: 'Adolescencia Temprana', text: 'Notas que tu cuerpo est√° cambiando r√°pidamente (el "estir√≥n") y te sientes un poco torpe e inseguro. Un amigo te dice: "¬øEst√°s bien? Te ves diferente".', choices: [{ icon: 'üí¨', text: 'Confiarle que te sientes raro con tu cuerpo.', effects: { identity: 10, social: 10, health: 5, vocation: 5 }, feedback: 'La empat√≠a y la comunicaci√≥n son claves para un futuro docente.', consejo: 'Consejo: Aceptar el "duelo por el cuerpo infantil perdido" es un paso crucial en esta etapa.' },{ icon: 'üòÇ', text: 'Hacer una broma para ocultar tu incomodidad.', effects: { identity: -5, social: 5 }, feedback: 'El humor puede ser una defensa, pero afrontar tus sentimientos es clave.', consejo: 'Consejo: Evitar la introspecci√≥n puede retrasar la construcci√≥n de tu identidad.' },{ icon: 'üò†', text: 'Enojarte y decirle que no es su asunto.', effects: { identity: -10, social: -15, vocation: -5 }, feedback: 'La paciencia se agota, pero un docente debe aprender a manejar sus emociones.', consejo: 'Consejo: El "humor cambiante" es t√≠pico de esta fase, pero la inteligencia emocional se practica.' }] },
            { stage: 'Adolescencia Temprana', text: 'Tus padres quieren saber todo lo que haces. Sientes una fuerte necesidad de tener tu propio espacio y privacidad.', choices: [{ icon: 'üó£Ô∏è', text: 'Hablar con ellos calmadamente sobre tu necesidad de privacidad.', effects: { identity: 10, social: 5, vocation: 5 }, feedback: 'Establecer l√≠mites con respeto es una habilidad social valiosa.', consejo: 'Consejo: La b√∫squeda de autonom√≠a es el motor del "segundo proceso de individuaci√≥n".' },{ icon: 'ü§´', text: 'Ocultarles cosas y volverte m√°s reservado.', effects: { identity: 5, social: -10 }, feedback: 'Si bien buscas autonom√≠a, esto puede generar desconfianza.', consejo: 'Consejo: El conflicto es un mecanismo para forjar la identidad, pero la confianza familiar es un factor protector.' },{ icon: 'üí•', text: 'Desafiar su autoridad constantemente y discutir por todo.', effects: { social: -15, academic: -5, vocation: -5 }, feedback: 'La confrontaci√≥n constante agota y no construye.', consejo: 'Consejo: Es normal cuestionar a los "padres idealizados de la infancia", pero el respeto mutuo es clave.' }] },
            { stage: 'Adolescencia Temprana', text: 'En clase, la mayor√≠a piensa "A" sobre un tema, pero t√∫ crees "B". El maestro pregunta tu opini√≥n.', choices: [{ icon: 'üôã', text: 'Defender tu punto de vista con argumentos.', effects: { identity: 15, academic: 5, vocation: 10 }, feedback: 'Tener iniciativa y pensamiento cr√≠tico es un rasgo de liderazgo.', consejo: 'Consejo: El pensamiento se vuelve m√°s concreto y extremista, pero ya puedes empezar a ejercitar la l√≥gica.' },{ icon: 'üòî', text: 'Decir lo mismo que los dem√°s para no destacar.', effects: { identity: -10, social: 5 }, feedback: 'Priorizar al grupo es com√∫n, pero puede llevar a la confusi√≥n de tu propia identidad.', consejo: 'Consejo: El grupo de pares es un gran soporte, pero la identidad se forja en la diferencia.' },{ icon: 'üö∂', text: 'Quedarte callado y no decir nada.', effects: { social: -5, academic: -5 }, feedback: 'La timidez es normal, pero la participaci√≥n activa es clave para aprender.', consejo: 'Consejo: El egocentrismo adolescente te hace sentir observado (audiencia imaginaria), pero es importante superarlo.' }] },
            { stage: 'Adolescencia Temprana', text: 'Notas que te sale acn√© y tu olor corporal ha cambiado. Te sientes muy cohibido al respecto.', choices: [{ icon: 'üßº', text: 'Investigar sobre higiene y cuidado personal.', effects: { health: 10, identity: 5 }, feedback: 'Hacerte cargo de tu cuerpo es un signo de madurez y auto-cuidado.', consejo: 'Consejo: El aumento de las gl√°ndulas seb√°ceas es un cambio biol√≥gico normal. La informaci√≥n es un factor protector.' },{ icon: 'üß¢', text: 'Intentar ocultarlo con ropa ancha y gorras.', effects: { identity: -10, social: -5 }, feedback: 'La verg√ºenza por los cambios corporales es com√∫n, pero puede afectar tu autoestima.', consejo: 'Consejo: La preocupaci√≥n por "¬øsoy normal?" es una constante. La respuesta casi siempre es s√≠.' },{ icon: 'üéÆ', text: 'Evitar salir y quedarte jugando videojuegos.', effects: { health: -5, social: -15, academic: -5 }, feedback: 'El aislamiento puede parecer una soluci√≥n, pero agrava la inseguridad.', consejo: 'Consejo: La adicci√≥n comportamental a la tecnolog√≠a es un riesgo psicosocial importante en esta etapa.' }] },
            
            // --- Adolescencia Media (14-17 a√±os) ---
            { stage: 'Adolescencia Media', text: 'Est√°s en una fiesta y un amigo popular te ofrece un cigarrillo. Todos te est√°n mirando. Sientes la presi√≥n del grupo.', choices: [{ icon: 'üö¨', text: 'Aceptar para no desentonar.', effects: { health: -15, social: 10, identity: -5 }, feedback: 'Ceder a la presi√≥n de grupo es un riesgo com√∫n en esta etapa.', consejo: 'Consejo: La "audiencia imaginaria" (creer que todos te juzgan) maximiza la presi√≥n de grupo.' },{ icon: 'üö´', text: 'Rechazarlo amablemente pero con firmeza.', effects: { health: 10, identity: 15, social: -5, vocation: 10 }, feedback: 'Mantener tus principios bajo presi√≥n fortalece tu identidad y car√°cter.', consejo: 'Consejo: Desarrollar habilidades para la vida, como la asertividad, es un factor de protecci√≥n clave.' },{ icon: 'üé≠', text: 'Tomarlo y fingir que fumas.', effects: { health: -5, social: 5, identity: -10 }, feedback: 'Intentar encajar a costa de tus valores genera confusi√≥n interna.', consejo: 'Consejo: La crisis es "Identidad vs. Confusi√≥n de Roles" (Erikson). Actos as√≠ alimentan la confusi√≥n.' }] },
            { stage: 'Adolescencia Media', text: 'Te sientes invencible, como si nada malo pudiera pasarte. Un amigo te reta a hacer algo arriesgado.', choices: [{ icon: 'üèçÔ∏è', text: 'Aceptar el reto. ¬°La vida es una sola!', effects: { health: -30, social: 10 }, feedback: 'Este sentimiento de omnipotencia puede llevar a conductas de riesgo peligrosas.', consejo: 'Consejo: La "f√°bula personal" (sentirte √∫nico e invulnerable) es una distorsi√≥n cognitiva de esta etapa.' },{ icon: 'üß†', text: 'Reconocer el peligro y negarte.', effects: { health: 15, identity: 10, vocation: 5 }, feedback: 'Tu capacidad de pensamiento abstracto te permite evaluar consecuencias.', consejo: 'Consejo: Usar el pensamiento hipot√©tico-deductivo (Piaget) para sopesar riesgos es signo de madurez.' },{ icon: 'üí°', text: 'Proponer una actividad emocionante pero segura.', effects: { health: 5, social: 15, identity: 5, vocation: 10 }, feedback: 'La creatividad para resolver conflictos es una gran cualidad docente.', consejo: 'Consejo: La maduraci√≥n incompleta de los l√≥bulos frontales dificulta el control de impulsos, pero no lo imposibilita.' }] },
            { stage: 'Adolescencia Media', text: 'Pasas horas en redes sociales, comparando tu vida con las de los dem√°s. Empiezas a sentir que tu vida es aburrida y t√∫ no eres suficiente.', choices: [{ icon: 'üßò', text: 'Limitar tu tiempo en redes y enfocarte en tus hobbies y estudios.', effects: { health: 10, identity: 10, social: -5, academic: 5, vocation: 5 }, feedback: 'Cuidar tu salud mental y enfocarte en el mundo real es crucial.', consejo: 'Consejo: El mundo digital es un "tercer agente de socializaci√≥n", pero la identidad debe consolidarse offline.' },{ icon: 'üëë', text: 'Crear un perfil "perfecto" para competir.', effects: { identity: -15, social: 5 }, feedback: 'Crear identidades falsas te aleja de tu verdadero yo.', consejo: 'Consejo: El impacto en la identidad es un riesgo psicosocial de las nuevas tecnolog√≠as.' },{ icon: 'ü´Ç', text: 'Hablar con un amigo o familiar sobre c√≥mo te sientes.', effects: { health: 15, identity: 5, social: 10 }, feedback: 'Buscar apoyo en tu red real es un factor protector fundamental.', consejo: 'Consejo: Una buena comunicaci√≥n familiar y con pares mitiga los factores de riesgo.' }] },
            { stage: 'Adolescencia Media', text: 'Te sientes profundamente incomprendido por los adultos. Piensas que tus sentimientos son tan intensos que nadie podr√≠a entenderlos.', choices: [{ icon: 'üìì', text: 'Escribir un diario para explorar tus pensamientos.', effects: { identity: 15, health: 5 }, feedback: 'La introspecci√≥n es una herramienta poderosa para construir el yo.', consejo: 'Consejo: Est√°s desarrollando la "metacognici√≥n" (pensar sobre el pensamiento), lo que aumenta la introspecci√≥n.' },{ icon: 'üì¢', text: 'Quejarte constantemente de que "nadie te entiende".', effects: { social: -10, identity: -5 }, feedback: 'Aunque te sientas as√≠, esta actitud puede alejar a las personas.', consejo: 'Consejo: Esto es parte de la "f√°bula personal", la creencia de ser √∫nico. Es una fase normal del egocentrismo adolescente.' },{ icon: 'üßë‚Äçü§ù‚Äçüßë', text: 'Hablar con tus amigos, que parecen sentir lo mismo.', effects: { social: 15, health: 5 }, feedback: 'Compartir experiencias con pares es crucial para sentirse validado.', consejo: 'Consejo: El grupo de pares se convierte en un espacio crucial para la experimentaci√≥n y la validaci√≥n.' }] },
            
            // --- Adolescencia Tard√≠a (18-21 a√±os) - TEM√ÅTICA ENSM ---
            { stage: 'Adolescencia Tard√≠a', text: 'Es momento de prepararte para el examen de admisi√≥n de la Normal Superior. Sientes la presi√≥n de una decisi√≥n que definir√° tu futuro como docente.', choices: [{ icon: 'üìö', text: 'Investigar el plan de estudios de la ENSM y crear un calendario de estudio riguroso.', effects: { academic: 20, identity: 15, vocation: 15 }, feedback: 'Tu disciplina y pasi√≥n por la ense√±anza demuestran tu vocaci√≥n.', consejo: 'Consejo: El pensamiento se orienta al futuro, basado en metas e ideales. Est√°s usando tus operaciones formales.' },{ icon: 'üòë', text: 'Estudiar solo lo que tus maestros te dicen, sin explorar m√°s.', effects: { academic: 5, identity: -10, vocation: -10 }, feedback: 'La vocaci√≥n docente requiere iniciativa y curiosidad, no solo cumplir.', consejo: 'Consejo: Forjar una identidad implica ir m√°s all√° de los roles asignados y explorar por cuenta propia.' },{ icon: 'üé≤', text: 'Confiar en tu suerte y no prepararte demasiado.', effects: { academic: -20, identity: -15, vocation: -15 }, feedback: 'El ingreso a la Normal Superior requiere esfuerzo y compromiso.', consejo: 'Consejo: El control de impulsos y la capacidad para sopesar riesgos y recompensas es mayor en esta etapa.' }] },
            { stage: 'Adolescencia Tard√≠a', text: 'Tu relaci√≥n de pareja se ha vuelto muy importante, pero tu preparaci√≥n para la ENSM consume mucho tiempo.', choices: [{ icon: 'ü§ù', text: 'Formar un grupo de estudio con tu pareja para apoyarse mutuamente.', effects: { social: 10, academic: 15, identity: 5, vocation: 5 }, feedback: 'Combinar tus metas con tus relaciones afectivas es un signo de gran madurez.', consejo: 'Consejo: Las relaciones de pareja se vuelven m√°s estables y se busca un equilibrio con otras √°reas de la vida.' },{ icon: '‚ù§Ô∏è', text: 'Priorizar a tu pareja, dejando el estudio en segundo plano.', effects: { social: 15, academic: -20 }, feedback: 'Descuidar tus metas a largo plazo puede traer arrepentimientos.', consejo: 'Consejo: La capacidad de compromiso con metas a futuro es un hito de la adolescencia tard√≠a.' },{ icon: 'üíî', text: 'Terminar la relaci√≥n para enfocarte 100% en el examen.', effects: { identity: 5, social: -15, academic: 10, health: -5 }, feedback: 'El aislamiento total puede afectar tu bienestar emocional.', consejo: 'Consejo: El apoyo social sigue siendo un factor protector importante, incluso con un enfoque acad√©mico.' }] },
            { stage: 'Adolescencia Tard√≠a', text: 'Miras hacia atr√°s y te das cuenta de que tus padres, algunos de ellos docentes, ten√≠an raz√≥n en muchas cosas sobre la disciplina y el esfuerzo.', choices: [{ icon: 'üë®‚Äçüè´', text: 'Compartirles tu sue√±o de entrar a la ENSM y pedirles consejo.', effects: { identity: 15, social: 15, vocation: 10 }, feedback: 'Excelente. Has establecido una relaci√≥n adulta con ellos, valorando su experiencia.', consejo: 'Consejo: Se produce una "reaceptaci√≥n de valores paternos", estableciendo una relaci√≥n m√°s adulta con ellos.' },{ icon: 'ü§ê', text: 'Ocultarles tus planes para que no se involucren.', effects: { identity: 5, social: -5 }, feedback: 'La independencia no significa rechazar el apoyo, sino saber integrarlo.', consejo: 'Consejo: Un sentido de la identidad m√°s firme permite aceptar consejos sin sentir que se pierde autonom√≠a.' },{ icon: 'ü§∑', text: 'Dejar que ellos decidan si la docencia es para ti.', effects: { identity: -20, academic: -5, vocation: -20 }, feedback: 'La vocaci√≥n debe ser tuya. Dejar que otros decidan por ti es un signo de confusi√≥n de identidad.', consejo: 'Consejo: No resolver la crisis de "Identidad vs. Confusi√≥n de Roles" puede llevar a la incapacidad de tomar decisiones vitales.' }] },
            { stage: 'Adolescencia Tard√≠a', text: 'Descubres que tienes una gran habilidad para explicar temas complejos a tus compa√±eros que tienen dificultades.', choices: [{ icon: 'üí°', text: 'Organizar sesiones de estudio grupales y voluntarias.', effects: { social: 15, academic: 10, vocation: 20 }, feedback: 'Est√°s actuando como un verdadero docente antes de serlo. ¬°Esa es la vocaci√≥n!', consejo: 'Consejo: Estrenar y ponerse a prueba en nuevas capacidades es parte del impulso vital hacia la adultez.' },{ icon: 'üí∏', text: 'Ofrecerles tutor√≠as, pero cobrando una peque√±a cuota.', effects: { academic: 5, vocation: -10 }, feedback: 'Es v√°lido valorar tu tiempo, pero la vocaci√≥n de servicio a menudo va primero.', consejo: 'Consejo: El desarrollo moral (Kohlberg) avanza hacia principios √©ticos universales, m√°s all√° del beneficio propio.' },{ icon: 'üòí', text: 'Guardarte tus conocimientos para asegurar tu propia calificaci√≥n.', effects: { academic: 5, vocation: -20, social: -10 }, feedback: 'El individualismo extremo choca con la esencia colaborativa de la docencia.', consejo: 'Consejo: Un sistema de valores propio y firme es una de las metas de esta etapa. El ego√≠smo no es una base s√≥lida.' }] }
        ];

        const randomEvents = [
            { text: '¬°Evento Sorpresa! Tu banda favorita viene a la ciudad la noche antes de un examen de simulaci√≥n.', choices: [{icon: 'üé∏', text: 'Ir al concierto. ¬°Una noche para despejarme!', effects: {social: 20, academic: -20, health: -5}, feedback: 'La diversi√≥n es importante, pero a veces tiene un costo acad√©mico.', consejo: 'Consejo: El equilibrio entre vida social y responsabilidades es un aprendizaje constante.'}, {icon: 'üìñ', text: 'Vender la entrada y enfocarte en la gu√≠a de estudio.', effects: {social: -10, academic: 15, vocation: 5}, feedback: 'Tomar decisiones responsables es un signo de madurez.', consejo: 'Consejo: La orientaci√≥n al futuro implica a veces sacrificar la gratificaci√≥n inmediata.'}]},
            { text: '¬°Evento Sorpresa! Te contagias de un resfriado fuerte y tienes que quedarte en cama por dos d√≠as.', choices: [{icon: 'üò¥', text: 'Aprovechar para descansar y recuperarte.', effects: {health: 15, academic: -10, social: -5}, feedback: 'Escuchar a tu cuerpo es fundamental para la salud a largo plazo.', consejo: 'Consejo: La salud es un factor de protecci√≥n. Descuidarla es una conducta de riesgo.'}, {icon: 'ü§í', text: 'Intentar seguir estudiando a pesar del malestar.', effects: {health: -15, academic: -5}, feedback: 'Ignorar las se√±ales de tu cuerpo puede empeorar las cosas.', consejo: 'Consejo: El estr√©s y la falta de sue√±o afectan el rendimiento acad√©mico y el bienestar general.'}]},
            { text: '¬°Evento Sorpresa! Un amigo cercano est√° pasando por un mal momento y necesita tu apoyo emocional.', choices: [{icon: 'ü´Ç', text: 'Dedicarle tiempo para escucharlo y apoyarlo.', effects: {social: 15, health: 5, vocation: 10}, feedback: 'La empat√≠a y el apoyo mutuo fortalecen tus lazos y tu car√°cter.', consejo: 'Consejo: Las relaciones de amistad estables son un pilar en la adolescencia tard√≠a.'}, {icon: 'üèÉ', text: 'Evitarlo porque no sabes qu√© decir y te incomoda.', effects: {social: -15, identity: -5}, feedback: 'Huir de las emociones de otros demuestra una dificultad para manejar las propias.', consejo: 'Consejo: La inteligencia emocional es una habilidad que se desarrolla y es vital para un docente.'}]},
            { text: '¬°Evento Sorpresa! Te ofrecen unirte a un equipo deportivo que exige mucho entrenamiento.', choices: [{icon: 'üèÜ', text: 'Aceptar el reto y organizar tu tiempo.', effects: {health: 15, social: 10, academic: -5}, feedback: 'El deporte es excelente para la salud y la disciplina.', consejo: 'Consejo: El ejercicio f√≠sico regular es un factor de protecci√≥n clave para un desarrollo saludable.'}, {icon: 'üôÖ', text: 'Rechazarlo para no afectar tus estudios.', effects: {academic: 10, health: -5}, feedback: 'Es una decisi√≥n prudente, pero no olvides la importancia de la actividad f√≠sica.', consejo: 'Consejo: El sedentarismo es una conducta de riesgo. Hay que buscar un equilibrio.'}]},
        ];
        
        const momentosClave = [
            { stage: 'Momento Clave', text: 'Un compa√±ero te ofrece las respuestas del pr√≥ximo examen de simulaci√≥n para la Normal. "Todos lo hacen", te dice. "Es la √∫nica forma de asegurar un lugar". Es una decisi√≥n que podr√≠a definir tu futuro.', choices: [{icon: 'üòá', text: 'Rechazarlo de plano y reportar la situaci√≥n.', effects: {academic: -10, identity: 20, vocation: 30}, feedback: 'Has tomado el camino dif√≠cil pero correcto. Tu integridad es tu mayor fortaleza como futuro docente, aunque te ponga en desventaja.', consejo: 'Consejo (Kohlberg): Has actuado desde un nivel postconvencional, basado en principios √©ticos universales, no en la conveniencia.'}, {icon: 'üòà', text: 'Aceptar las respuestas. El fin justifica los medios.', effects: {academic: 25, identity: -25, vocation: -40}, feedback: 'Aseguraste una buena nota, pero a costa de tus principios. Un docente que hace trampa, ¬øqu√© podr√° ense√±ar a sus alumnos sobre la honestidad?', consejo: 'Consejo: La delincuencia y las conductas deshonestas son un riesgo social. Esta decisi√≥n socava la construcci√≥n de una identidad s√≥lida.'}, {icon: 'ü§´', text: 'No aceptarlas, pero no decir nada para no meterte en problemas.', effects: {identity: -5, vocation: -10}, feedback: 'Evitaste hacer trampa, pero tu silencio te hace c√≥mplice. A veces, la √©tica requiere acci√≥n y valent√≠a.', consejo: 'Consejo (Kohlberg): Te has quedado en un nivel convencional, donde mantener el orden y no tener problemas es m√°s importante que hacer lo correcto.'}]}
        ];

        let gameState = {};

        function initGameState(avatar) {
            gameState = {
                stats: { health: 60, identity: 50, social: 60, academic: 50, vocation: 50 },
                currentStageIndex: 0,
                eventsInStage: 0,
                currentEvent: null,
                avatar: avatar,
                hadRandomEvent: false,
                momentoClaveDone: false
            };
        }

        const stages = [
            { name: 'Adolescencia Temprana', desc: 'Inicia el viaje. Tu cuerpo y mente empiezan a cambiar. El foco est√° en los amigos, la familia y descubrir qui√©n eres en un mundo que de repente parece diferente.' },
            { name: 'Adolescencia Media', desc: 'Entras en la etapa m√°s intensa. La b√∫squeda de independencia se acelera, el grupo de pares es tu universo y sientes que puedes com√©rtelo todo. Aqu√≠ se toman las decisiones m√°s arriesgadas.' },
            { name: 'Adolescencia Tard√≠a', desc: 'La recta final. Tu identidad es m√°s s√≥lida, piensas en el futuro y te preparas para el gran reto: convertirte en un aspirante a la Escuela Normal Superior.' },
        ];

        function updateStatsUI(oldStats = {}) {
            dom.statsContainer.innerHTML = '';
            for (const key in gameState.stats) {
                const statInfo = STAT_NAMES[key];
                const value = Math.max(0, Math.min(100, gameState.stats[key]));
                let colorClass = 'bg-green-500';
                if (value < 50) colorClass = 'bg-yellow-500';
                if (value < 25) colorClass = 'bg-red-500';
                const statElement = document.createElement('div');
                statElement.className = "relative";
                statElement.innerHTML = `
                    <div class="text-sm font-semibold text-gray-300 mb-1">${statInfo.icon} ${statInfo.label}</div>
                    <div class="progress-bar-bg w-full h-4 rounded-full">
                        <div class="progress-bar-fg h-4 rounded-full ${colorClass}" style="width: ${value}%;"></div>
                    </div>
                `;
                dom.statsContainer.appendChild(statElement);
                const oldValue = oldStats[key];
                if (oldValue !== undefined && oldValue !== value) {
                    const diff = value - oldValue;
                    const changeIndicator = document.createElement('span');
                    changeIndicator.textContent = `${diff > 0 ? '+' : ''}${diff}`;
                    changeIndicator.className = `stat-change ${diff > 0 ? 'positive' : 'negative'}`;
                    statElement.appendChild(changeIndicator);
                }
            }
        }

        function showFeedback(text, consejo) {
            dom.feedbackText.textContent = text;
            dom.consejoDocente.textContent = consejo;
            dom.feedbackCard.classList.remove('hidden');
            dom.feedbackCard.classList.add('fade-in');
            dom.choicesContainer.childNodes.forEach(button => button.disabled = true);
            dom.nextBtn.classList.remove('hidden');
        }

        function displayEvent() {
            dom.gameScreen.classList.remove('hidden');
            dom.transitionScreen.classList.add('hidden');
            dom.feedbackCard.classList.add('hidden');
            dom.nextBtn.classList.add('hidden');

            const currentStageName = stages[gameState.currentStageIndex].name;
            const stageEvents = storyEvents.filter(e => e.stage === currentStageName);
            
            // L√≥gica para Momento Clave
            if (currentStageName === 'Adolescencia Media' && !gameState.momentoClaveDone && Math.random() < 0.4) {
                 gameState.currentEvent = momentosClave[0];
                 gameState.momentoClaveDone = true;
            } else if (gameState.hadRandomEvent) {
                gameState.currentEvent = stageEvents[gameState.eventsInStage];
                gameState.hadRandomEvent = false;
            } else {
                 if (gameState.eventsInStage >= stageEvents.length) {
                    moveToNextStage();
                    return;
                }
                gameState.currentEvent = stageEvents[gameState.eventsInStage];
            }
            
            dom.stageTitle.textContent = gameState.currentEvent.stage;
            dom.eventText.textContent = gameState.currentEvent.text;
            dom.choicesContainer.innerHTML = '';

            gameState.currentEvent.choices.forEach((choice) => {
                const button = document.createElement('button');
                button.innerHTML = `<span class="text-2xl">${choice.icon}</span> <span>${choice.text}</span>`;
                button.className = 'w-full bg-gray-600 hover:bg-cyan-700 text-white font-semibold py-3 px-4 rounded-lg choice-btn text-left';
                button.onclick = () => {
                    const oldStats = { ...gameState.stats };
                    for (const stat in choice.effects) {
                        gameState.stats[stat] = Math.max(0, Math.min(100, gameState.stats[stat] + choice.effects[stat]));
                    }
                    updateStatsUI(oldStats);
                    showFeedback(choice.feedback, choice.consejo);
                };
                dom.choicesContainer.appendChild(button);
            });
        }
        
        function moveToNextStage() {
            gameState.currentStageIndex++;
            gameState.eventsInStage = 0;
            if (gameState.currentStageIndex >= stages.length) {
                endGame();
            } else {
                showTransitionScreen();
            }
        }
        
        function showTransitionScreen() {
            dom.gameScreen.classList.add('hidden');
            dom.transitionScreen.classList.remove('hidden');
            const stage = stages[gameState.currentStageIndex];
            dom.transitionTitle.textContent = `Iniciando: ${stage.name}`;
            dom.transitionText.textContent = stage.desc;
        }

        function nextTurn() {
            // Si el √∫ltimo evento fue un Momento Clave, volvemos al flujo normal sin avanzar.
            if(gameState.currentEvent.stage === 'Momento Clave') {
                 gameState.hadRandomEvent = false; // flag para evitar ciclo
                 displayEvent();
                 return;
            }

            gameState.eventsInStage++;
            const currentStageName = stages[gameState.currentStageIndex].name;
            const stageEvents = storyEvents.filter(e => e.stage === currentStageName);
            const isLastEventOfStage = gameState.eventsInStage >= stageEvents.length;

            if (!isLastEventOfStage && Math.random() < 0.33) {
                gameState.currentEvent = randomEvents[Math.floor(Math.random() * randomEvents.length)];
                gameState.hadRandomEvent = true;
                displayEvent(); 
            } else {
                displayEvent();
            }
        }

        function selectAvatar(avatar) {
            initGameState(avatar);
            dom.avatarDisplay.textContent = gameState.avatar;
            dom.avatarScreen.classList.add('hidden');
            showTransitionScreen();
        }

        function showAvatarScreen() {
            dom.startScreen.classList.add('hidden');
            dom.endScreen.classList.add('hidden');
            dom.avatarScreen.classList.remove('hidden');
        }

        function endGame() {
            dom.gameScreen.classList.add('hidden');
            dom.endScreen.classList.remove('hidden');
            const { academic, identity, vocation, health, social } = gameState.stats;

            let title, text;

            if (academic >= 80 && identity >= 70 && vocation >= 75) {
                title = "Final: El Docente Integral";
                text = "¬°Felicidades! No solo ingresaste a la ENSM con excelencia, sino que has forjado una identidad s√≥lida y una vocaci√≥n inquebrantable. Est√°s en el camino para ser un educador que inspira, transforma y deja huella.";
            } else if (academic >= 70 && vocation < 60) {
                title = "Final: El T√©cnico Brillante";
                text = "Tu gran capacidad acad√©mica te abri√≥ las puertas de la Normal. Sin embargo, el viaje descuid√≥ tu pasi√≥n. Ense√±ar es m√°s que transmitir datos; es conectar. La ENSM ser√° tu oportunidad para encontrar la vocaci√≥n que llevas dentro.";
            } else if (academic < 65 && vocation >= 75) {
                title = "Final: El Coraz√≥n sin M√©todo";
                text = "No lograste ingresar esta vez, pero tu vocaci√≥n es inmensa y genuina. El conocimiento t√©cnico se adquiere, pero la pasi√≥n por ense√±ar no se aprende. Prep√°rate mejor, pule tus m√©todos y vuelve a intentarlo. Hacen falta docentes como t√∫.";
            } else if (academic >= 65 && vocation >= 60) {
                 title = "Final: El Normalista Prometedor";
                text = "¬°Lo lograste! Ingresaste a la ENSM. El camino tuvo sus desaf√≠os y aprendiste a equilibrar tus distintas facetas. Tienes la capacidad y la vocaci√≥n. Ahora empieza el verdadero trabajo para convertirte en el gran docente que puedes ser.";
            } else if (social >= 75 && identity >= 65 && academic < 65) {
                title = "Final: El L√≠der Social";
                text = "El examen de la Normal no sali√≥ como esperabas, pero en el camino descubriste algo m√°s grande: tu habilidad para conectar, liderar y ayudar a tu comunidad. La docencia no es el √∫nico camino para ense√±ar. Tu aula es el mundo.";
            } else if (academic >= 70 && (health < 40 || social < 40)) {
                title = "Final: El Sacrificio (Burnout)";
                text = "Ingresaste. A costa de todo. El enfoque absoluto en lo acad√©mico te hizo descuidar tu salud y tus relaciones. El √©xito no vale de nada si te pierdes a ti mismo en el proceso. La ENSM te exigir√° un mejor equilibrio para no consumirte.";
            } else {
                title = "Final: El Confundido";
                text = "El viaje ha terminado y te sientes m√°s perdido que al principio. No lograste ingresar y no est√°s seguro de qui√©n eres o qu√© quieres. Esto no es un fracaso, sino una se√±al. T√≥mate un tiempo para el autodescubrimiento. El camino correcto aparecer√° cuando est√©s listo.";
            }

            dom.endTitle.textContent = title;
            dom.endText.textContent = text;
            dom.finalStats.innerHTML = '<h3 class="text-xl font-bold mb-2 text-gray-300">Resultado Final</h3>';
            const finalStatsGrid = document.createElement('div');
            finalStatsGrid.className = 'grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-2 max-w-lg mx-auto';
            for (const key in gameState.stats) {
                const statInfo = STAT_NAMES[key];
                const value = gameState.stats[key];
                finalStatsGrid.innerHTML += `
                    <div class="bg-gray-700 p-3 rounded-lg">
                        <div class="font-semibold text-sm">${statInfo.icon} ${statInfo.label}</div>
                        <div class="text-2xl font-bold text-cyan-400">${value}</div>
                    </div>
                `;
            }
            dom.finalStats.appendChild(finalStatsGrid);
        }

        dom.startBtn.addEventListener('click', showAvatarScreen);
        dom.restartBtn.addEventListener('click', showAvatarScreen);
        dom.nextBtn.addEventListener('click', nextTurn);
        dom.continueBtn.addEventListener('click', displayEvent);
        
        // Iniciar en la primera pantalla de transici√≥n para que el flujo sea consistente
        dom.continueBtn.onclick = () => {
             dom.transitionScreen.classList.add('hidden');
             displayEvent();
        }

    </script>
</body>
</html>
</body>
</html>
